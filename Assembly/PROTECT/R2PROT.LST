Turbo Assembler	 Version 4.1	    12/31/03 17:02:18	    Page 1
H:\programs\ASSEMBLY\PROTECT\r2prot.asm



      1					 ;REAL MODE TO PROTECTED MODE
      2					 ;PROGRAM BY MADHUR AHUJA
      3					 ;INDIA
      4					 ;DATED: 30th Oct 03
      5
      6					 .386
      7	00000000			 codesg	 segment
      8						 assume	cs:codesg,ds:codesg,ss:codesg
      9						 org 100h
     10	00000100			 main:
     11	00000100  EB 36				 jmp	 begin
     12	00000102  02*(00000000)		 gdt	 dd	 2 dup(0)	 ;first	null descriptor
     13					 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     14	0000010A  0FFF				 dw	 0fffh		 ;limit=ffff, base =0
     15	0000010C  0000				 dw	 0
     16	0000010E  00				 db	 0
     17	0000010F  9A				 db	 10011010b	 ;p=1,dpl=00,type=11010(1a for code)
     18	00000110  CF				 db	 11001111b	 ;g=1,b=1,0,avl=0, limit=ffh
     19	00000111  00				 db	 0
     20					 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     21	00000112  FFFF			 gdt1	 dw	 0ffffh		 ;limit=ffff
     22	00000114  0000				 dw	 0		 ;base=0
     23	00000116  00				 db	 0		 ;base=0
     24	00000117  92				 db	 10010010b	 ;p=1,dpl=00,type=10010(12 for data)[expand up,writeable,non+
     25					 access]
     26	00000118  CF				 db	 11001111b	 ;g=1,b=1,0,avl=0,limit=ff
     27	00000119  00				 db	 0		 ;base=0
     28					 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     29	0000011A  0FFF			 gdt2	 dw	 0fffh		 ;limit=ffff, base =0
     30	0000011C  0000				 dw	 0
     31	0000011E  00				 db	 0
     32	0000011F  9A				 db	 10011010b	 ;p=1,dpl=00,type=11010(1a for code)[non conforming,	    +
     33					 readaable,non access]
     34	00000120  CF				 db	 11001111b	 ;g=1,b=1,0,avl=0, limit=ffh
     35	00000121  00				 db	 0		 ;base=0
     36					 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     37	00000122  0FFF			 gdt3	 dw	 0fffh		 ;limit=ffff, base =0
     38	00000124  0000				 dw	 0
     39	00000126  00				 db	 0
     40	00000127  92				 db	 10010010b	 ;p=1,dpl=00,type=10010(12 for data)[expand up,writeable,non+
     41					 access]
     42	00000128  CF				 db	 11001111b	 ;g=1,b=1,0,avl=0, limit=ffh
     43	00000129  00				 db	 0		 ;base=0
     44					 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     45	0000012A  0FFF			 gdt4	 dw	 0fffh		 ;limit=ffff, base =0
     46	0000012C  0000				 dw	 0
     47	0000012E  00				 db	 0
     48	0000012F  9A				 db	 10011010b	 ;p=1,dpl=00,type=11010(1a for code)[non conforming,	    +
     49					 readaable,non access]
     50	00000130  CF				 db	 11001111b	 ;g=1,b=1,0,avl=0, limit=ffh
     51	00000131  00				 db	 0		 ;base=0
     52
     53	00000132			 label	 gdt_end
     54	00000132  002F			 gdtr	 dw gdt_end - gdt - 1	 ; GDT limit
     55	00000134  00000102r			 dd gdt			 ; (GDT	base gets set above)
     56
     57	00000138			 begin:
Turbo Assembler	 Version 4.1	    12/31/03 17:02:18	    Page 2
H:\programs\ASSEMBLY\PROTECT\r2prot.asm



     58	00000138  33 DB				 xor	 ebx,ebx
     59	0000013A  66| 8C DB			 mov	 bx,ds
     60	0000013D  C1 E3	04			 shl	 ebx,4	 ;bx contains the starting physical address of program		    +
     61					 ; BX="linear" address of segment base
     62	00000140  8B C3				 mov	 eax,ebx  ;lea eax=00012340h
     63	00000142  66| A3 0000011Cr		 mov	 word ptr [gdt2	+ 2],ax		      ;	set base address of 32-bit segments
     64	00000148  66| A3 00000124r		 mov	 word ptr [gdt3	+ 2],ax
     65	0000014E  66| A3 0000012Cr		 mov	 word ptr [gdt4	+ 2],ax		      ;	set base address of 16-bit segments
     66	00000154  66| A3 00000002		 mov	 word ptr [gdt5	+ 2],ax		 ;ax=2340h
**Error** H:\programs\ASSEMBLY\PROTECT\r2prot.asm(61) Undefined	symbol:	GDT5
     67
     68	0000015A  C1 E8	10			 shr	 eax,16	 ;eax=
     69	0000015D  A2 0000011Er			 mov	 byte ptr [gdt2	+ 4],al
     70	00000162  A2 00000126r			 mov	 byte ptr [gdt3	+ 4],al
     71	00000167  A2 0000012Er			 mov	 byte ptr [gdt4	+ 4],al
     72	0000016C  A2 00000004			 mov	 byte ptr [gdt5	+ 4],al
**Error** H:\programs\ASSEMBLY\PROTECT\r2prot.asm(67) Undefined	symbol:	GDT5
     73
     74	00000171  88 25	00000121r		 mov	 byte ptr [gdt2	+ 7],ah
     75	00000177  88 25	00000129r		 mov	 byte ptr [gdt3	+ 7],ah
     76	0000017D  88 25	00000131r		 mov	 byte ptr [gdt4	+ 7],ah
     77	00000183  88 25	00000007		 mov	 byte ptr [gdt5	+ 7],ah
**Error** H:\programs\ASSEMBLY\PROTECT\r2prot.asm(72) Undefined	symbol:	GDT5
     78
     79	00000189  33 DB				 xor	 ebx,ebx
     80	0000018B  66| 8C DB			 mov	 bx,ds			 ;get segment base
     81	0000018E  C1 E3	04			 shl	 ebx,4			 ;get physical	address
     82	00000191  BA 00000102r			 mov	 edx,offset gdt
     83	00000196  66| 03 DA			 add	 bx,dx		 ;add offset of	gdt
     84	00000199  66| 89 1D 00000134r		 mov	 [gdtr+2],bx		 ;set base address
     85
     86
     87
     88
     89	000001A0			 quit:
     90	000001A0  B4 4C				 mov	 ah,4ch
     91	000001A2  CD 21				 int	 21h
     92	000001A4			 codesg	 ends
     93					 end	 main
Turbo Assembler	 Version 4.1	    12/31/03 17:02:18	    Page 3
Symbol Table




Symbol Name		Type   Value			   Cref	(defined at #)

??DATE			Text   "12/31/03"
??FILENAME		Text   "r2prot	"
??TIME			Text   "17:02:18"
??VERSION		Number 040A
@CPU			Text   0F0FH			   #6
@CURSEG			Text   CODESG			   #7
@FILENAME		Text   R2PROT
@WORDSIZE		Text   4			   #6  #7
BEGIN			Near   CODESG:0138		   11  #57
GDT			Dword  CODESG:0102		   #12	54  55	82
GDT1			Word   CODESG:0112		   #21
GDT2			Word   CODESG:011A		   #29	63  69	74
GDT3			Word   CODESG:0122		   #37	64  70	75
GDT4			Word   CODESG:012A		   #45	65  71	76
GDTR			Word   CODESG:0132		   #54	84
GDT_END			Word   CODESG:0132		   #53	54
MAIN			Near   CODESG:0100		   #10	93
QUIT			Near   CODESG:01A0		   #89

Groups & Segments	Bit Size Align	Combine	Class	   Cref	(defined at #)

CODESG			32  01A4 Para	none		   #7  8  8  8
Turbo Assembler	 Version 4.1	    12/31/03 17:02:18	    Page 4
Error Summary



	mov 	word ptr [gdt5 + 2],ax		;ax=2340h
**Error** H:\programs\ASSEMBLY\PROTECT\r2prot.asm(61) Undefined	symbol:	GDT5
	mov 	byte ptr [gdt5 + 4],al
**Error** H:\programs\ASSEMBLY\PROTECT\r2prot.asm(67) Undefined	symbol:	GDT5
	mov 	byte ptr [gdt5 + 7],ah
**Error** H:\programs\ASSEMBLY\PROTECT\r2prot.asm(72) Undefined	symbol:	GDT5
